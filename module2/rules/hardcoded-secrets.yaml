rules:
  - id: hardcoded-aws-access-key
    patterns:
      - pattern-regex: (AKIA[0-9A-Z]{16})
    message: >-
      Hardcoded AWS Access Key ID detected. AWS credentials should be stored
      in environment variables, AWS credentials file, or secrets manager.
      Rotate this key immediately if it has been committed to version control.
    languages: [python, json, generic]
    severity: ERROR
    metadata:
      cwe: "CWE-798: Use of Hard-coded Credentials"
      owasp: "A3:2017 Sensitive Data Exposure"
      category: security

  - id: hardcoded-aws-secret-key
    patterns:
      - pattern-either:
          - pattern: $VAR = "wJalrXUtnFEMI..."
          - pattern-regex: (?i)(aws_secret|secret_key|aws_secret_access_key)\s*=\s*["'][A-Za-z0-9/+=]{40}["']
    message: >-
      Potential AWS Secret Access Key detected. Never hardcode AWS credentials.
      Use environment variables, IAM roles, or AWS Secrets Manager.
    languages: [python]
    severity: ERROR
    metadata:
      cwe: "CWE-798: Use of Hard-coded Credentials"
      category: security

  - id: hardcoded-api-key-assignment
    patterns:
      - pattern-either:
          - pattern: $KEY = "sk-proj-..."
          - pattern: $KEY = "sk-..."
          - pattern-regex: (?i)(api_key|apikey|api_token)\s*=\s*["'][a-zA-Z0-9_-]{20,}["']
    message: >-
      Hardcoded API key detected. API keys should be loaded from environment
      variables or a secrets manager, not hardcoded in source code.
    languages: [python]
    severity: ERROR
    metadata:
      cwe: "CWE-798: Use of Hard-coded Credentials"
      category: security

  - id: hardcoded-password-assignment
    patterns:
      - pattern-either:
          - pattern-regex: (?i)(password|passwd|pwd|secret)\s*=\s*["'][^"']{8,}["']
          - pattern: $PASSWORD = "..."
            metavariable-regex:
              metavariable: $PASSWORD
              regex: (?i)(password|passwd|pwd|db_pass|db_password)
    message: >-
      Hardcoded password detected. Passwords should never be stored in source code.
      Use environment variables, secrets manager, or secure vault solutions.
    languages: [python]
    severity: ERROR
    metadata:
      cwe: "CWE-259: Use of Hard-coded Password"
      category: security

  - id: hardcoded-database-url
    patterns:
      - pattern-regex: (?i)(postgresql|mysql|mongodb|redis)://[^:]+:[^@]+@
    message: >-
      Database connection string with embedded credentials detected.
      Use environment variables for database credentials.
    languages: [python, generic]
    severity: ERROR
    metadata:
      cwe: "CWE-798: Use of Hard-coded Credentials"
      category: security

  - id: hardcoded-private-key
    patterns:
      - pattern-regex: (?i)(private_key|privatekey|priv_key)\s*=\s*["']0x[a-fA-F0-9]{64}["']
    message: >-
      CRITICAL: Hardcoded private key detected. Private keys must never be
      stored in source code. This could lead to complete compromise of
      associated accounts/wallets.
    languages: [python]
    severity: ERROR
    metadata:
      cwe: "CWE-321: Use of Hard-coded Cryptographic Key"
      category: security

  - id: hardcoded-jwt-secret
    patterns:
      - pattern-regex: (?i)(jwt_secret|jwt_key|signing_key|token_secret)\s*=\s*["'][^"']{16,}["']
    message: >-
      Hardcoded JWT signing secret detected. JWT secrets should be stored
      in environment variables or a secrets manager.
    languages: [python]
    severity: ERROR
    metadata:
      cwe: "CWE-798: Use of Hard-coded Credentials"
      category: security

  - id: hardcoded-huggingface-token
    patterns:
      - pattern-regex: hf_[a-zA-Z0-9]{34}
    message: >-
      HuggingFace API token detected. Store tokens in environment variables
      or use the huggingface-cli login command.
    languages: [python, generic]
    severity: ERROR
    metadata:
      cwe: "CWE-798: Use of Hard-coded Credentials"
      category: security

  - id: secret-in-logging
    patterns:
      - pattern-either:
          - pattern: logging.$METHOD(... + $SECRET + ...)
          - pattern: logging.$METHOD(f"...{$SECRET}...")
          - pattern: print(f"...{$API_KEY}...")
            metavariable-regex:
              metavariable: $API_KEY
              regex: (?i)(api_key|secret|password|token|credential)
    message: >-
      Potential secret being logged. Avoid logging sensitive information
      like API keys, passwords, or tokens.
    languages: [python]
    severity: WARNING
    metadata:
      cwe: "CWE-532: Insertion of Sensitive Information into Log File"
      category: security

  - id: notebook-hardcoded-credentials
    patterns:
      - pattern-regex: (?i)["'](AKIA[0-9A-Z]{16}|sk-[a-zA-Z0-9]{48}|hf_[a-zA-Z0-9]{34})["']
    message: >-
      Hardcoded credentials in Jupyter notebook. Notebooks are often shared
      or committed to version control. Use environment variables or
      python-dotenv to load secrets.
    languages: [json, generic]
    severity: ERROR
    metadata:
      cwe: "CWE-798: Use of Hard-coded Credentials"
      category: security
